<!doctype html>
<head>
	<title>Dedguenodgo</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="favicon.ico" rel="icon" type="image/x-icon" />
	<link rel="stylesheet" type="text/css" href="css/lib/bootstrap.min.css" />
	<link rel="stylesheet" type="text/css" href="css/lib/bootstrap-theme.min.css" />
	<link rel="stylesheet" type="text/css" href="css/style.css" />
	<script src="js/lib/jquery.min.js"></script>
	<script src="js/lib/knockout-3.0.0.debug.js"></script>
	<script src="js/view-model.js"></script>
	<script src="js/localstorage-model.js"></script>
</head>
<body>
	<h1>Dedguenodgo <a id="deconnection" href="#" data-bind="visible: loggedInUser, click: function() {loggedInUser(null)}">déconnexion</a> </h1>
	<!-- ko if:!loggedInUser() -->
	<div class="container">
		<div class="jumbotron">
			<h2>Bienvenue sur dedguenodgo 2.0 !</h2>
			<p>Ce site permet, à la manière d'un petit carnet en papier, de réaliser des listes de Noël. Vous pouvez ajouter des cadeaux et les rayer si vous comptez les offrir.<p>
		</div>
		<h4>Exemples</h4>
		<ul>
			<li>Anne ajoute "nain de jardin" dans sa liste. Franck raye le cadeau pour dire qu'il va l'acheter. Tout le monde sauf Anne voit que le cadeau est rayé (pas de surprise gachée)</li>
			<li>Olivier ajoute "vernis à ongles mauve" dans la liste d'Elisabeth. Tout le monde sauf Elisabeth voit le cadeau dans liste d'Elisabeth (pas de surprise gachée). Celui qui achète le cadeau le raye. Tout le monde sauf Elisabeth voit le cadeau rayé.</li>
		</ul>
		<h2>C'est parti !</h2>
		<form class="form" data-bind="submit: function() {loggedInUser(loggedInUserChoice());}">
			<div class="form-group">
				<label>Qui êtes-vous ?</label>
				<select class="form-control" data-bind="options: Object.keys(users()), value: loggedInUserChoice, optionsText:function(id) {return users()[id].name;}, optionsCaption: 'choisir...'"></select> 
			</div>
			<button class="btn btn-primary" type="submit"> Se connecter</button>
		</form>
	</div>
	<!-- /ko -->

	<!-- ko if:loggedInUser() -->
	<select id="list-select" class="form-control input-large" data-bind="options: lists(), value: selectedList, optionsValue: 'id', optionsText:'label'"></select> 
	<p class="jumbotron" data-bind="visible: displayedPresents().length == 0">
		Cette liste est vide ! Vous pouvez ajouter des idées de cadeaux à l'aide du bouton ci-dessous
	</p>
	<ul class="list-group" data-bind="foreach: displayedPresents()">
		<!-- the present -->
		<li class="present list-group-item" data-bind="event: { dblclick: function(){$root.editPresent($data);} }, css: { offered: $root.displayPresentAsOffered($data) , deleted: deletedBy }">
		<a data-bind="visible: !deletedBy, click: function() { $root.deletePresent($data); }">Supprimer</a>
		<a data-bind="visible: !deletedBy, click: function() { $root.editPresent($data); }">Modifier</a>
		<a data-bind="visible: !deletedBy, click: function() { $root.togglePresentOffered($data); }, text: $root.displayPresentAsOffered($data) ? 'Dé-rayer' : 'Rayer', attr: { title: $root.displayPresentAsOffered($data) ? 'Marquer comme non offert': 'Marquer comme offert' }"></a>
		<h4 class="list-group-item-heading">
			<span class="title" data-bind="text:title"></span>
			<span class="offered-by" data-bind="text: $root.displayPresentAsOffered($data) || ''"></span>
			<span class="deleted-by" data-bind="visible: deletedBy, text: !deletedBy ? '' : '(Ce cadeau a été supprimé par ' + $root.users()[deletedBy].name + ')'"></span>
		</h4>
		<p class="list-group-item-text" data-bind="text:description"> </p>
		</li>
	</ul>
	<button class="btn btn-primary" data-bind="click: addPresent">Ajouter un cadeau</button>
	<!--present edition dialog -->
	<div class="modal-backdrop in" data-bind="visible: editing, click: cancelEdition"></div>
	<div class="modal" data-bind="visible: editing" style="display: block;">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true" data-bind="click: cancelEdition">&times;</button>
					<h4 class="modal-title" data-bind="text: editPopupText()"></h4>
				</div>
				<div class="modal-body">
					<form class="form" data-bind="submit: saveEditedPresent">
						<div class="form-group">
							<label>Titre</label>
							<input class="form-control" type="text" data-bind="value:$root.edition.title, hasfocus: editing()"></input>
						</div>
						<div class="form-group">
							<label>Description</label>
							<textarea class="form-control" data-bind="value:$root.edition.description"></textarea>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal" data-bind="click: cancelEdition">Annuler</button>
					<button type="button" class="btn btn-primary" data-bind="click: saveEditedPresent">Sauvegarder les changements</button>
				</div>
			</div>
		</div>
	</div>

	<!--command execution panel-->
	<div id="command-execution" data-bind="visible: slowShowingLoadingMessage() || successMessage() || undoAction()">
		<div class="loading" data-bind="text: slowShowingLoadingMessage"></div>
		<div class="confirm">
			<button type="button" class="close" data-bind="visible: successMessage() || undoAction(), click: discardConfirm">&times;</button> <span data-bind="text: successMessage"></span> <a href="" data-bind="visible: undoAction, click: undoAction()">Annuler</a> 
		</div>
	</div>
	<!-- /ko -->
	<script>
		$(document).ready(function() {
			window.viewModel = createLocalStorageModel();
			ko.applyBindings(window.viewModel);
		});
	</script>
</body>
